const jwt=require("jsonwebtoken"),config=require("./config"),{all:all}=require("axios");module.exports=allowedRoles=>(req,res,next)=>{const token=req.body.token||req.query.token||req.headers["x-access-token"];if(!token)return res.status(403).send({error:!0,message:"No token provided."});jwt.verify(token,config.secret,(function(err,decoded){if(err)return res.status(401).json({error:!0,message:"Unauthorized access."});req.decoded=decoded,console.log(allowedRoles);var nextok=!1;return allowedRoles.length||(nextok=!0,next()),allowedRoles.forEach(role=>{1===decoded[role]&&(req.params.id?decoded.id===parseInt(req.params.id)&&(console.log("decoded.id = "+decoded.id),res.send(decoded),nextok=!0,next()):(nextOk=!0,next()))}),nextok?void 0:res.status(403).json({error:!0,message:"Unauthorized access."})}))};